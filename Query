-- 1: 

-- View all visits with patient and doctor information 
-- Show: AppointmentID, Patient Name, Doctor Name, Date, Department, Diagnosis

SELECT 
  V.AppointmentID, 
  p.first_name || ' ' || p.last_name AS Patient_Name, 
  d.first_name || ' '|| d.last_name AS Doctor_Name, 
  V.appointmentdate AS Date, 
  V.department, 
  V.Diagnosis
FROM visits V
JOIN doctors d
ON v.doctorid = d.doctor_id
JOIN patients p 
ON v.patientid = patient_id

-- 2: 

-- List all procedures with their costs

-- Show: procedure type, cost, and visit_id, Order by most expensive first

SELECT 
  procedure_type, 
  procedure_cost, 
  visit_id 
FROM procedures
ORDER BY procedure_cost DESC

-- 3: 

-- Count total visits by department
-- Show: Department name and total number of visits
-- Order by highest count first

SELECT 
  department, 
  count(*) AS total_visits 
FROM visits
GROUP BY department
ORDER BY total_visits DESC

-- 4: 

-- Total revenue by department
-- Show: Department, Total Visits, Total Procedures, Total Revenue, Average Procedure Cost
-- Order by highest revenue first

SELECT v.department, 
	COUNT(DISTINCT v.appointmentid) AS total_visits, 
	COUNT(p.procedure_id) AS total_procedures, 
	SUM(p.procedure_cost) AS total_revenue, 
	ROUND(AVG(p.procedure_cost),2) AS avg_procedure_cost
FROM visits v
join procedures p
ON v.appointmentid = p.visit_id
GROUP BY v.department
ORDER BY Total_revenue DESC

-- 5: 

--Top 10 most expensive procedures
--Show: Procedure type, cost, department, diagnosis, patient name

SELECT p.procedure_type, 
  p.procedure_cost, 
  v.department, 
  v.diagnosis, 
  pa.first_name || ''|| pa.last_name AS patient_name
FROM procedures p 
JOIN visits v
ON p.procedure_id = v.patientid
JOIN patients pa ON v.patientid = pa.patient_id
LIMIT 10

-- 6: 

-- Patients with multiple visits
-- Show: PatientID, Patient Name, Visit Count, First Visit Date, Last Visit Date
-- Only show patients with MORE than 1 visit
-- Order by most visits first

SELECT
	pa.patient_id AS PatientID, 
	pa.first_name || ' '|| pa.last_name AS PatientName,
	COUNT(v.appointmentid) AS VisitCount, 
	MIN(v.appointmentdate) AS FirstVisit, 
	MAX(v.appointmentdate) AS LastVisit
FROM patients pa 
JOIN visits v ON pa.patient_id = v.patientid
GROUP BY pa.patient_id, pa.first_name, pa.last_name
HAVING COUNT (v.appointmentid) > 1
ORDER BY VisitCount DESC 

--7: 

-- Doctors with the highest patient volume
-- Show: Doctor Name, Department, Total Patients Seen
-- Order by highest count first

SELECT 
    d.first_name || ' ' || d.last_name AS DoctorName,
    v.department AS Department,
    COUNT(DISTINCT v.patientid) AS TotalPatientsSeen
FROM doctors d
JOIN visits v ON d.doctor_id = v.doctorid
GROUP BY d.first_name, d.last_name, v.department
ORDER BY TotalPatientsSeen DESC;

-- 8: 

-- What are the 15 most common diagnoses in the hospital, how many times does each diagnosis occur, and which department treats each diagnosis

-- Show the diagnosis name
-- Show how many times that diagnosis appears (call this "Frequency")
-- Show which department treats it
-- Sort by the diagnoses that appear most often first
-- Only show the top 15 results

SELECT diagnosis, COUNT(diagnosis) AS frequency, department
	FROM visits 
	GROUP BY diagnosis, department
	ORDER BY frequency DESC
	LIMIT 15

-- 9: 

-- Patients who have never had a procedure

-- Show: PatientID, Patient Name

SELECT p.patient_id, p.first_name ||' '|| p.last_name AS fullname
	FROM patients p 
	LEFT JOIN visits v ON p.patient_id = v.patientid
	left join procedures ps 
	ON v.appointmentid = ps.visit_id
	WHERE ps.procedure_id IS NULL

-- 10: 

-- Doctors generating the most revenue
-- Show: Doctor Name, Department, Total Revenue
-- Order by highest revenue first

SELECT d.first_name || ' '|| d.last_name AS doctors_name, 
	v.department,  SUM(p.procedure_cost) AS total_cost
	FROM doctors d JOIN visits v
	ON d.doctor_id = v.doctorid 
	JOIN procedures p 
	ON v.appointmentid = p.visit_id
	GROUP BY doctors_name, v.department
	ORDER BY total_cost DESC











